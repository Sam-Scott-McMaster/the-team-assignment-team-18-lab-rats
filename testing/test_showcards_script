#!/bin/bash

cd ..

# TEST SCRIPT FOR "showcards" bash script

# Testing environment setup
TEST_DIR="test_deck"
mkdir -p "$TEST_DIR"

# Echo some sample data into the flashcard file and default 'again' difficulty file for the deck
echo -e "Card 1 | Answer 1\nCard 2 | Answer 2\nCard 3 | Answer 3" > "$TEST_DIR/flashcards.txt"
echo -e "Card 1 | Answer 1\nCard 2 | Answer 2\nCard 3 | Answer 3" > "$TEST_DIR/again_flashcards.txt"

> "$TEST_DIR/easy_flashcards.txt"
> "$TEST_DIR/good_flashcards.txt"
> "$TEST_DIR/hard_flashcards.txt"

# Function to validate the file's contents using output.log file
validate_file_contents() {
    local file=$1
    local expected=$2
    local description=$3

    actual=$(cat "$file")
    if [[ "$actual" == "$expected" ]]; then
        echo "Test passed: $description"
    else
        echo "Test failed: $description"
        echo "Expected:"
        echo "$expected"
        echo "Actual:"
        echo "$actual"
        exit 1
    fi
}

# Simulate input and run the script
INPUTS="

a

g
q
"
echo -e "\n\ng\nq" | bash ./showcards "$TEST_DIR" > output.log 2>&1

# Validate changes were made
EXPECTED_FLASHCARDS="Card 1 | Answer 1\nCard 3 | Answer 3"
validate_file_contents "$TEST_DIR/flashcards.txt" "$EXPECTED_FLASHCARDS" "Flashcards file after session"

EXPECTED_AGAIN="Card 2 | Answer 2"
validate_file_contents "$TEST_DIR/again_flashcards.txt" "$EXPECTED_AGAIN" "Again flashcards file"

EXPECTED_GOOD=""
validate_file_contents "$TEST_DIR/good_flashcards.txt" "$EXPECTED_GOOD" "Good flashcards file"

# Clean up the testing environment
rm -rf "$TEST_DIR"
rm output.log

echo "Tests all passed."
